Датчик расстояния в проектах Arduino
Способность ультразвукового датчика определять расстояние до объекта основано на принципе сонара – посылая пучок ультразвука, и получая его отражение с задержкой, устройство определяет наличие объектов и расстояние до них. Ультразвуковые сигналы, генерируемые приемником, отражаясь от препятствия, возвращаются к нему через определенный промежуток времени. Именно этот временной интервал становится характеристикой помогающей определить расстояние до объекта.
Внимание! Так как в основу принципа действия положен ультразвук, то такой датчик не подходит для определения расстояния до звукопоглощающих объектов. Оптимальными для измерения являются предметы с ровной гладкой поверхностью.
Описание датчика HC SR04
Ультразвуковой датчик расстояния Ардуино HC-SR04Датчик расстояния Ардуино является прибором бесконтактного типа, и обеспечивает высокоточное измерение и стабильность. Диапазон дальности его измерения составляет от 2 до 400 см. На его работу не оказывает существенного воздействия электромагнитные излучения и солнечная энергия. В комплект модуля с HC SR04 arduino также входят ресивер и трансмиттер.

Ультразвуковой дальномер HC SR04 имеет такие технические параметры:

Питающее напряжение 5В;
Рабочий параметр силы т ока – 15 мА;
Сила тока в пассивном состоянии < 2 мА;
Обзорный угол – 15°;
Сенсорное разрешение – 0,3 см;
Измерительный угол – 30°;
Ширина импульса – 10-6 с.
Ультразвуковой датчик расстояния Ардуино HC-SR04

Датчик оснащен четырьмя выводами (стандарт 2, 54 мм):

Контакт питания положительного типа – +5В;
Trig (Т) – выход сигнала входа;
Echo (R) – вывод сигнала выхода;
GND – вывод «Земля».

Схема взаимодействия с Arduino
Для получения данных, необходимо выполнить такую последовательность действий:

Подать на выход Trig импульс длительностью 10 микросек;
В ультразвуковом дальномере hc sr04 подключенном к arduino произойдет преобразование сигнала в 8 импульсов с частотой 40 кГц, которые через излучатель будут посланы вперед;
Когда импульсы дойдут до препятствия, они отразятся от него и будут приняты приемником R, что обеспечит наличие входного сигнала на выходе Echo;
На стороне контроллера полученный сигнал при помощи формул следует перевести в расстояние.
При делении ширины импульса на 58.2, получим данные в сантиметрах, при делении на 148 – в дюймах.

Ультразвуковой датчик расстояния Ардуино HC-SR04

Подключение HC SR04 к Arduino
Выполнить подключение ультразвукового датчика расстояния к плате Arduino достаточно просто. Схема подключения показана на рисунке.

Подключение датчика расстояния HC-SR04

Контакт земли подключаем к выводу GND на плате Arduino, выход питания соединяем с 5V. Выходы Trig и Echo подсоединяем к arduino на цифровые пины. Вариант подключения с помощью макетной платы:

Подключение датчика HC-SR04 к плате ардуино

Библиотека для работы с HC SR04
Для облегчения работы с датчиком расстояния HC SR04 на arduino можно использовать библиотеку NewPing. Она не имеет проблем с пинговыми доступами и добавляет некоторые новые функции.

К особенностям библиотеки можно отнести:

Возможность работы с различными ультразвуковыми датчиками;
Может работать с датчиком расстояния всего через один пин;
Отсутствие отставания на 1 секунду при отсутствии пинга эха;
Для простой коррекции ошибок есть встроенный цифровой фильтр;
Максимально точный расчет расстояния.
Скачать бибилотеку NewPing можно здесь

Точность измерения расстояния датчиком HC SR04
Точность датчика зависит от нескольких факторов:

температуры и влажности воздуха;
расстояния до объекта;
расположения относительно датчика (согласно диаграммы излучения);
качества исполнения элементов модуля датчика.
В основу принципа действия любого ультразвукового датчика заложено явление отражения акустических волн, распространяющихся в воздухе. Но как известно из курса физики, скорость распространения звука в воздухе зависит от свойств этого самого воздуха (в первую очередь от температуры). Датчик же, испуская волны и замеряя время до их возврата, не догадывается, в какой именно среде они будут распространяться и берет для расчетов некоторую среднюю величину. В реальных условиях из-за фактора температуры воздуха HC-SR04 может ошибаться от 1 до 3-5 см.

Фактор расстояния до объекта важен, т.к. растет вероятность отражения от соседних предметов, к тому же и сам сигнал затухает с расстоянием.

Также для повышения точности надо правильно направить датчик: сделать так, чтобы предмет был в рамках конуса диаграммы направленности. Проще говоря,  “глазки” HC-SR04 должны смотреть прямо на предмет.Диаграмма направленности HC-SR04

Для уменьшения ошибок и погрешности измерений обычно выполняются следующие действия:

усредняются значения (несколько раз замеряем, убираем всплески, потом находим среднее);
с помощью датчиков (например, DHT11 или DHT22) определяется температура и вносятся поправочные коэффициенты;
датчик устанавливается на серводвигатель, с помощью которого мы “поворачиваем голову”, перемещая диаграмму направленности влево или вправо.
Примеры использования датчика расстояния
Давайте рассмотрим пример простого проекта с платой Arduino Uno и датчиком расстояния HC SR04. В скетче мы будем получать значение расстояния до предметов и выводить их в монитор порта в среде Arduino IDE. Вы сможете легко изменить скетч и схему подключения, чтобы датчик сигнализировал о приближении или отдалении предмета.

Подключение датчика к ардуино
При написании скетча использовалась следующий вариант распиновки подключения датчика:

VCC: +5V
Trig – 12 пин
Echo – 11 пин
Земля (GND) – Земля (GND)



Ультразвуковые датчики расстояния достаточно универсальны и точны, что позволяет их использовать для большинства любительских проектов. В статье рассмотрен крайне популярный датчик HC SR04, который легко подключается к плате ардуино (для этого следует сразу предусмотреть два свободных пина, но есть вариант подключения и с одним пином). Для работы с датчиком существуют несколько бесплатных библиотек (в статье рассмотрена лишь одна из них, NewPing), но можно обойтись и без них – алгоритм взаимодействия с внутренним контроллером датчика достаточно прост, мы показали его в этой статье.

Исходя из собственного опыта, можно утверждать, что датчик HC-SR04 показывает точность в пределах одного сантиметра на расстояниях от 10 см до 2 м. На более коротких и дальних дистанциях возможно появление сильных помех, что сильно зависит от окружающих предметов и способа использования. Но в большинстве случаев HC-SR04 отлично справлялся со своей работой.